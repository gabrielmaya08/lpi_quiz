<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz LPI - Simulado</title>
    <style>
        :root { --cor-primaria: #8e44ad; --cor-fundo: #f3e5f5; --cor-card: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--cor-fundo); padding: 20px; margin: 0; }
        .container { max-width: 800px; margin: auto; background: var(--cor-card); padding: 30px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--cor-primaria); margin-bottom: 20px; padding-bottom: 10px; }
        h1 { color: var(--cor-primaria); margin: 0; font-size: 24px; }
        #timer { font-size: 20px; font-weight: bold; color: #e74c3c; background: #ffebee; padding: 5px 15px; border-radius: 20px; border: 2px solid #e74c3c; }
        .pergunta { margin-bottom: 20px; padding: 15px; border-radius: 8px; background: #fdfbff; border: 1px solid #e1bee7; }
        .pergunta p { font-weight: bold; margin-bottom: 12px; color: #4a148c; }
        label { display: block; margin-bottom: 10px; cursor: pointer; padding: 8px; border-radius: 5px; }
        label:hover { background-color: #f3e5f5; }
        .btn { width: 100%; padding: 15px; background: var(--cor-primaria); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        #resultado { margin-top: 20px; padding: 20px; text-align: center; font-size: 22px; border-radius: 10px; display: none; background: #e8f5e9; color: #2e7d32; }
        .ranking { margin-top: 30px; border-top: 1px solid #ddd; padding-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border: 1px solid #eee; text-align: left; }
        th { background-color: var(--cor-primaria); color: white; }
        input[type="text"] { width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; transition: 0.3s; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Simulado LPI</h1>
        <div id="timer">10:00</div>
    </header>
    
    <div id="identificacao">
        <label>Seu Nome (Obrigat√≥rio):</label>
        <input type="text" id="nomeUsuario" placeholder="Digite seu nome para validar o resultado...">
    </div>

    <div id="quiz-container"></div>
    
    <button class="btn" id="btnFinalizar" onclick="finalizarQuiz()">Finalizar Simulado</button>
    <div id="resultado"></div>

    <div class="ranking">
        <h3>üèÜ Melhores Pontua√ß√µes Consolidadas</h3>
        <table id="tabelaRanking">
            <thead><tr><th>Nome</th><th>Pontos Totais</th></tr></thead>
            <tbody><tr><td colspan="2">Carregando ranking...</td></tr></tbody>
        </table>
    </div>
</div>

<script>
    const URL_GOOGLE_SCRIPT = "https://script.google.com/macros/s/AKfycbwL_7_XW1WhImX-9jpJ6JJ81kQMC3dgGWShTAKkVBgugtiaj2ve81NplJDuTN1k0_uNnw/exec";

    const bancoDePerguntas = [
        { q: "Qual comando exibe o diret√≥rio atual?", options: ["ls", "pwd", "cd", "dir"], correct: 1 },
        { q: "Qual diret√≥rio cont√©m arquivos essenciais do sistema?", options: ["/home", "/opt", "/etc", "/var"], correct: 2 },
        { q: "Qual comando lista processos ativos?", options: ["top", "ls", "free", "df"], correct: 0 },
        { q: "Para criar um diret√≥rio usamos o comando:", options: ["rm", "mkdir", "rmdir", "touch"], correct: 1 },
        { q: "Qual arquivo armazena contas de usu√°rios?", options: ["/etc/shadow", "/etc/passwd", "/etc/group", "/etc/login"], correct: 1 },
        { q: "O que o comando `chmod 755` faz?", options: ["S√≥ leitura", "RWX dono e RX outros", "Remove execu√ß√£o", "RWX todos"], correct: 1 },
        { q: "Qual comando altera propriet√°rio?", options: ["chmod", "chown", "chgrp", "usermod"], correct: 1 },
        { q: "Qual comando move arquivos?", options: ["cp", "mv", "rm", "touch"], correct: 1 },
        { q: "Qual diret√≥rio guarda logs do sistema?", options: ["/bin", "/var/log", "/srv", "/opt"], correct: 1 },
        { q: "Qual comando mostra uso de disco?", options: ["free", "top", "df -h", "uname -a"], correct: 2 },
        { q: "O que significa o comando `sudo`?", options: ["Executar como root", "Ver permiss√µes", "Criar usu√°rio", "Sair do terminal"], correct: 0 },
        { q: "Qual o diret√≥rio inicial do root?", options: ["/home/root", "/root", "/system", "/admin"], correct: 1 },
        { q: "Qual comando apaga arquivo?", options: ["rm", "erase", "del", "clear"], correct: 0 },
        { q: "Qual servi√ßo gerencia inicializa√ß√£o moderna?", options: ["sysvinit", "init.d", "systemd", "rc.local"], correct: 2 },
        { q: "Qual comando v√™ IP da m√°quina?", options: ["ip addr", "lsnet", "netip", "getip"], correct: 0 },
        { q: "Qual porta padr√£o do SSH?", options: ["22", "80", "21", "443"], correct: 0 },
        { q: "Qual arquivo cont√©m DNS configurado?", options: ["resolv.conf", "hosts.conf", "dns.cfg", "net.conf"], correct: 0 },
        { q: "O que faz `ping`?", options: ["Testa DNS", "Testa conectividade ICMP", "Lista processos", "Mostra portas"], correct: 1 },
        { q: "Qual comando compacta arquivos em .tar.gz?", options: ["zip", "gzip", "tar czf", "pack"], correct: 2 },
        { q: "Qual comando procura texto em arquivos?", options: ["findtxt", "search", "grep", "cat -f"], correct: 2 },
        { q: "O que faz `cat /etc/passwd`?", options: ["Edita usu√°rios", "Mostra lista de usu√°rios", "Deleta contas", "Reinicia sistema"], correct: 1 },
        { q: "Dono, grupo e outros definem:", options: ["pol√≠ticas", "permiss√µes", "servi√ßos", "boot"], correct: 1 },
        { q: "`chmod +x` adiciona:", options: ["leitura", "execu√ß√£o", "escrita", "nenhuma"], correct: 1 },
        { q: "`ls -l` mostra:", options: ["permiss√µes e donos", "s√≥ arquivos", "s√≥ ocultos", "s√≥ diret√≥rios"], correct: 0 },
        { q: "`/bin` cont√©m:", options: ["libs", "comandos essenciais", "configs", "logs"], correct: 1 },
        { q: "`/home` cont√©m:", options: ["logs", "configs", "usu√°rios", "root"], correct: 2 },
        { q: "`/etc/shadow` cont√©m:", options: ["senhas", "rede", "timezone", "bootloader"], correct: 0 },
        { q: "`man ls` faz:", options: ["apaga arquivos", "mostra manual", "lista diret√≥rios", "configura servi√ßo"], correct: 1 },
        { q: "Qual comando reinicia o sistema?", options: ["stop", "reload", "reboot", "shutdown -c"], correct: 2 },
        { q: "`ps aux` lista:", options: ["s√≥ processos do usu√°rio", "s√≥ root", "todos processos", "diret√≥rios"], correct: 2 },
        { q: "`kill PID` faz:", options: ["cria processo", "mata processo", "pausa servi√ßo", "finaliza sess√£o"], correct: 1 },
        { q: "Kernel √©:", options: ["interface gr√°fica", "n√∫cleo do SO", "BIOS", "aplicativo"], correct: 1 },
        { q: "`df -h` mostra:", options: ["mem√≥ria RAM", "uso de CPU", "discos", "permiss√µes"], correct: 2 },
        { q: "N√∫mero 644 em chmod √©:", options: ["RW dono e R outros", "RWX todos", "RX todos", "RWX dono"], correct: 0 },
        { q: "Sinal SIGKILL √© o n√∫mero:", options: ["1", "9", "15", "0"], correct: 1 },
        { q: "`/var` cont√©m:", options: ["logs e dados vari√°veis", "config root", "libs", "scripts"], correct: 0 },
        { q: "Comando para alterar senha:", options: ["pass", "passwd", "pwd -p", "userpass"], correct: 1 },
        { q: "`uname -a` mostra:", options: ["logs", "vers√£o kernel", "usu√°rios", "processos"], correct: 1 },
        { q: "`/usr/bin` cont√©m:", options: ["bin√°rios essenciais", "bin√°rios de usu√°rios", "arquivos root", "libs"], correct: 1 },
        { q: "Quem usa `apt install`?", options: ["Debian", "CentOS", "Fedora", "Arch"], correct: 0 },
        { q: "Qual comando instala pacote no Red Hat?", options: ["apt", "yum/dnf", "pacman", "rpm-get"], correct: 1 },
        { q: "Para ver servi√ßos no systemd:", options: ["sysctrl", "service list", "systemctl", "initd"], correct: 2 },
        { q: "O que faz `tail -f`?", options: ["mostra in√≠cio", "mostra final cont√≠nuo", "lista tudo", "apaga"], correct: 1 },
        { q: "Arquivo `/etc/hosts`:", options: ["guarda hostnames locais", "DNS p√∫blico", "interfaces", "rotas"], correct: 0 },
        { q: "`ssh user@IP`:", options: ["copia arquivo", "abre conex√£o remota shell", "reinicia rede", "lista usu√°rios"], correct: 1 },
        { q: "Porta 80 √© usada por:", options: ["FTP", "HTTP", "SSH", "DHCP"], correct: 1 },
        { q: "Porta 53:", options: ["DNS", "SSH", "FTP", "HTTPS"], correct: 0 },
        { q: "O comando `su -`:", options: ["muda usu√°rio", "mostra permiss√µes", "cria root", "renomeia usu√°rio"], correct: 0 },
        { q: "Extens√£o `.sh` significa:", options: ["script shell", "arquivo texto", "bin√°rio", "kernel"], correct: 0 },
        { q: "Comando para editar arquivos:", options: ["edit", "nano/vi", "open", "change"], correct: 1 },
        { q: "`/boot` cont√©m:", options: ["arquivos do kernel", "scripts", "logs", "usu√°rios"], correct: 0 },
        { q: "O que √© swap?", options: ["espa√ßo RAM virtual", "rede", "log", "driver"], correct: 0 },
        { q: "Comando para criar arquivo vazio:", options: ["rm", "mkfile", "touch", "cat"], correct: 2 },
        { q: "`crontab -e`:", options: ["edita agendamentos", "mostra logs", "reinicia cron", "apaga jobs"], correct: 0 },
        { q: "Express√£o `*/5 * * * *`:", options: ["roda a cada 5 horas", "a cada 5 minutos", "a cada 5 dias", "diariamente"], correct: 1 },
        { q: "Comando para copiar:", options: ["rm", "cp", "mv", "copyfile"], correct: 1 },
        { q: "Comando para ver hardware:", options: ["hwinfo", "lshw", "free", "uname"], correct: 1 },
        { q: "`/dev` cont√©m:", options: ["drivers", "dispositivos", "scripts", "logs"], correct: 1 },
        { q: "Processo init tem PID:", options: ["0", "1", "100", "10"], correct: 1 },
        { q: "Script come√ßa com:", options: ["<run>", "#!/bin/bash", "exec sh", "shell:"], correct: 1 },
        { q: "Comando para contar linhas:", options: ["count", "wc -l", "linecount", "txtwc"], correct: 1 },
        { q: "`grep -i`:", options: ["busca case-insensitive", "busca recursiva", "busca regex", "mostra arquivos"], correct: 0 },
        { q: "`grep -r`:", options: ["recursivo", "ignora case", "busca simples", "busca regex"], correct: 0 },
        { q: "O que faz `chmod 600`?", options: ["s√≥ root l√™", "s√≥ dono l√™/escreve", "acesso total", "nenhum acesso"], correct: 1 },
        { q: "`/opt` cont√©m:", options: ["pacotes opcionais", "logs", "kernel", "scripts"], correct: 0 },
        { q: "Vari√°vel $HOME cont√©m:", options: ["raiz", "diret√≥rio do usu√°rio", "bin√°rios", "servi√ßos"], correct: 1 },
        { q: "`echo $PATH` mostra:", options: ["redes", "vari√°veis", "caminhos execut√°veis", "processos"], correct: 2 },
        { q: "`hostname`:", options: ["muda nome", "exibe nome da m√°quina", "exibe IP", "reinicia rede"], correct: 1 },
        { q: "`/sbin` cont√©m:", options: ["bin√°rios administrativos", "pacotes de usu√°rio", "logs", "drivers"], correct: 0 },
        { q: "`ping -c 4`:", options: ["4 pings", "ping com contador CPU", "ping com cache", "ping em porta 4"], correct: 0 },
        { q: "`ifconfig` pertence ao pacote:", options: ["net-tools", "iputils", "openssh", "kernel-dev"], correct: 0 },
        { q: "`chmod o-r` remove:", options: ["leitura do dono", "leitura do grupo", "leitura de outros", "execu√ß√£o"], correct: 2 },
        { q: "`/proc` cont√©m:", options: ["processos", "drivers", "logs", "pacotes"], correct: 0 },
        { q: "`mount` serve para:", options: ["montar sistemas de arquivos", "iniciar kernel", "copiar arquivos", "criar discos"], correct: 0 },
        { q: "Linha `UUID=xxx` em `/etc/fstab`:", options: ["define rede", "define disco", "define usu√°rio", "define firewall"], correct: 1 },
        { q: "Porta 443:", options: ["HTTP", "HTTPS", "FTP", "SSH"], correct: 1 },
        { q: "Porta 25:", options: ["SMTP", "HTTP", "DNS", "SNMP"], correct: 0 },
        { q: "`scp` serve para:", options: ["copiar via SSH", "copiar local", "apagar", "monitorar"], correct: 0 },
        { q: "O comando `history`:", options: ["limpa terminal", "lista hist√≥rico", "lista arquivos", "limpa cache"], correct: 1 },
        { q: "`chmod` trabalha com:", options: ["diret√≥rios", "permiss√µes", "usu√°rios", "mem√≥ria"], correct: 1 },
        { q: "`free -h` mostra:", options: ["discos", "mem√≥ria RAM", "usu√°rios", "CPU"], correct: 1 },
        { q: "`/tmp` cont√©m:", options: ["logs", "tempor√°rios", "scripts", "home"], correct: 1 },
        { q: "Qual comando mostra rotas?", options: ["ifconfig -r", "route/ip route", "ip -g", "netstatdns"], correct: 1 },
        { q: "`netstat -tlnp` mostra:", options: ["portas abertas", "DNS", "hist√≥rico", "processos mortos"], correct: 0 },
        { q: "`dig` serve para:", options: ["ping", "traceroute", "consulta DNS", "listar IP"], correct: 2 },
        { q: "`traceroute` mostra:", options: ["usu√°rios", "caminho at√© destino", "permiss√µes", "discos"], correct: 1 },
        { q: "`chmod g+w`:", options: ["adiciona escrita ao grupo", "dono", "outros", "remove escrita"], correct: 0 },
        { q: "`/lib` cont√©m:", options: ["bibliotecas", "logs", "scripts", "bin√°rios"], correct: 0 },
        { q: "`useradd`:", options: ["cria usu√°rio", "apaga usu√°rio", "muda senha", "lista grupos"], correct: 0 },
        { q: "`groupadd`:", options: ["apaga usu√°rio", "cria grupo", "cria senha", "cria root"], correct: 1 },
        { q: "pasta `/run` guarda:", options: ["servi√ßos ativos", "usu√°rios", "DNS", "cron"], correct: 0 },
        { q: "`id usuario` mostra:", options: ["permiss√µes", "uid/gid", "cpu", "rede"], correct: 1 },
        { q: "`/etc/fstab`:", options: ["monta arquivos", "rede", "swap", "processos"], correct: 0 },
        { q: "`rm -r`:", options: ["remove recursivo", "remove logs", "remove pasta boot", "remove apenas arquivos"], correct: 0 },
        { q: "`/srv` cont√©m:", options: ["dados de servi√ßos", "scripts", "tmp", "rede"], correct: 0 },
        { q: "`curl` faz:", options: ["requisi√ß√µes web", "edita arquivos", "backup", "criptografia"], correct: 0 },
        { q: "`wget`:", options: ["browser CLI", "editor", "gerenciador", "leitor"], correct: 0 },
        { q: "`chmod 777`:", options: ["libera tudo", "bloqueia tudo", "s√≥ root acessa", "s√≥ dono acessa"], correct: 0 },
        { q: "`ip link`:", options: ["configura interface", "lista processos", "usa DNS", "lista discos"], correct: 0 },
        { q: "`systemctl status`:", options: ["status de servi√ßo", "instala pacote", "cria job", "atualiza disco"], correct: 0 }
    ];

    let perguntasSorteadas = [];
    let tempoRestante = 600;
    let intervaloTimer;

    function iniciarTimer() {
        intervaloTimer = setInterval(() => {
            let minutos = Math.floor(tempoRestante / 60);
            let segundos = tempoRestante % 60;
            segundos = segundos < 10 ? '0' + segundos : segundos;
            document.getElementById('timer').innerHTML = `${minutos}:${segundos}`;
            if (tempoRestante <= 0) {
                clearInterval(intervaloTimer);
                finalizarQuiz(true);
            }
            tempoRestante--;
        }, 1000);
    }

    function iniciarQuiz() {
        perguntasSorteadas = bancoDePerguntas.sort(() => 0.5 - Math.random()).slice(0, 10);
        const container = document.getElementById('quiz-container');
        container.innerHTML = "";
        perguntasSorteadas.forEach((p, index) => {
            let html = `<div class="pergunta"><p>${index + 1}. ${p.q}</p>`;
            p.options.forEach((opt, i) => {
                html += `<label><input type="radio" name="p${index}" value="${i}"> ${opt}</label>`;
            });
            html += `</div>`;
            container.innerHTML += html;
        });
        iniciarTimer();
        atualizarTabelaRanking();
    }

    async function finalizarQuiz(forcado = false) {
        const inputNome = document.getElementById('nomeUsuario');
        const nome = inputNome.value.trim();

        // VALIDA√á√ÉO RIGOROSA DO NOME
        if (!nome) {
            alert("ERRO: Voc√™ precisa digitar seu nome para salvar o simulado!");
            inputNome.style.borderColor = "red";
            inputNome.style.backgroundColor = "#fff0f0";
            inputNome.focus();
            return; // Interrompe totalmente a fun√ß√£o aqui
        }

        let pontos = 0;
        let respondidas = 0;

        perguntasSorteadas.forEach((p, index) => {
            const selecionada = document.querySelector(`input[name="p${index}"]:checked`);
            if (selecionada) {
                respondidas++;
                if (parseInt(selecionada.value) === p.correct) pontos += 10;
            }
        });

        if (!forcado && respondidas < 10) {
            alert("Por favor, responda todas as quest√µes!");
            return;
        }

        // Se chegou aqui, o nome existe e as quest√µes foram respondidas.
        clearInterval(intervaloTimer);
        const btn = document.getElementById('btnFinalizar');
        btn.disabled = true;
        btn.innerText = "Enviando dados...";

        await salvarNoRanking(nome, pontos);
        
        document.getElementById('resultado').style.display = "block";
        document.getElementById('resultado').innerHTML = `<h3>Simulado Conclu√≠do!</h3><p>Parab√©ns <b>${nome}</b>, sua nota foi: <b>${pontos} pontos</b></p>`;
        btn.style.display = "none";
        document.getElementById('identificacao').style.display = "none";
    }

    async function salvarNoRanking(nome, pontos) {
        try {
            // Envia para o Google Sheets
            await fetch(URL_GOOGLE_SCRIPT, {
                method: "POST",
                mode: "no-cors",
                body: JSON.stringify({ nome: nome, pontos: pontos })
            });
            
            // Aguarda um pouco para o Google processar e atualiza a tabela
            setTimeout(atualizarTabelaRanking, 2000);
        } catch (e) {
            console.error("Erro ao salvar:", e);
        }
    }

async function atualizarTabelaRanking() {
        try {
            const res = await fetch(URL_GOOGLE_SCRIPT);
            const dadosBrutos = await res.json();
            const tbody = document.querySelector('#tabelaRanking tbody');
            
            if (!dadosBrutos || dadosBrutos.length === 0) {
                tbody.innerHTML = "<tr><td colspan='2'>Nenhuma pontua√ß√£o registrada.</td></tr>";
                return;
            }

            const rankingAgrupado = {};

            dadosBrutos.forEach(item => {
                // item[0] costuma ser o Nome, item[1] costuma ser o Ponto
                if (item && item.length >= 2) {
                    let nomeOriginal = item[0].toString().trim();
                    
                    // Tentamos pegar os pontos da coluna 2, se n√£o for n√∫mero, tentamos a coluna 3
                    // Isso evita erro caso voc√™ tenha inserido uma coluna de Data na planilha
                    let pontos = parseInt(item[1]);
                    if (isNaN(pontos)) pontos = parseInt(item[2]) || 0;

                    let chave = nomeOriginal.toLowerCase();

                    if (chave !== "") { // Ignora linhas vazias
                        if (rankingAgrupado[chave]) {
                            rankingAgrupado[chave].pontos += pontos;
                        } else {
                            rankingAgrupado[chave] = { nome: nomeOriginal, pontos: pontos };
                        }
                    }
                }
            });

            const rankingFinal = Object.values(rankingAgrupado);
            
            // Ordena do maior para o menor
            rankingFinal.sort((a, b) => b.pontos - a.pontos);

            // Limpa e desenha a tabela
            tbody.innerHTML = ""; 
            rankingFinal.slice(0, 10).forEach(item => {
                tbody.innerHTML += `<tr><td>${item.nome}</td><td>${item.pontos} pts</td></tr>`;
            });

        } catch (e) { 
            console.log("Erro ao carregar ranking:", e);
            const tbody = document.querySelector('#tabelaRanking tbody');
            tbody.innerHTML = "<tr><td colspan='2'>Erro ao atualizar ranking.</td></tr>";
        }
    }

            const rankingAgrupado = {};
            dadosBrutos.forEach(item => {
                if (item && item.length >= 2) {
                    let nomeOriginal = item[0].toString().trim();
                    let pontos = parseInt(item[1]) || 0;
                    let chave = nomeOriginal.toLowerCase();

                    if (rankingAgrupado[chave]) {
                        rankingAgrupado[chave].pontos += pontos;
                    } else {
                        rankingAgrupado[chave] = { nome: nomeOriginal, pontos: pontos };
                    }
                }
            });

            const rankingFinal = Object.values(rankingAgrupado);
            rankingFinal.sort((a, b) => b.pontos - a.pontos);

            rankingFinal.slice(0, 10).forEach(item => {
                tbody.innerHTML += `<tr><td>${item.nome}</td><td>${item.pontos} pts</td></tr>`;
            });
        } catch (e) { 
            console.log("Erro ao carregar ranking:", e); 
        }
    }

    // Resetar cor do campo quando o usu√°rio digitar
    document.getElementById('nomeUsuario').addEventListener('input', function() {
        this.style.borderColor = "#ddd";
        this.style.backgroundColor = "#fff";
    });

    window.onload = iniciarQuiz;
</script>
</body>
</html>
