<!DOCTYPE html>
<html lang="pt-br">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Quiz LPI - Simulado</title>
Â  Â  <style>
Â  Â  Â  Â  :root { --cor-primaria: #8e44ad; --cor-fundo: #f3e5f5; --cor-card: #ffffff; }
Â  Â  Â  Â  body { font-family: 'Segoe UI', sans-serif; background-color: var(--cor-fundo); padding: 20px; margin: 0; }
Â  Â  Â  Â  .container { max-width: 800px; margin: auto; background: var(--cor-card); padding: 30px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
Â  Â  Â  Â  header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--cor-primaria); margin-bottom: 20px; padding-bottom: 10px; }
Â  Â  Â  Â  h1 { color: var(--cor-primaria); margin: 0; font-size: 24px; }
Â  Â  Â  Â  #timer { font-size: 20px; font-weight: bold; color: #e74c3c; background: #ffebee; padding: 5px 15px; border-radius: 20px; border: 2px solid #e74c3c; }
Â  Â  Â  Â  .pergunta { margin-bottom: 20px; padding: 15px; border-radius: 8px; background: #fdfbff; border: 1px solid #e1bee7; }
Â  Â  Â  Â  .pergunta p { font-weight: bold; margin-bottom: 12px; color: #4a148c; }
Â  Â  Â  Â  label { display: block; margin-bottom: 10px; cursor: pointer; padding: 8px; border-radius: 5px; }
Â  Â  Â  Â  label:hover { background-color: #f3e5f5; }
Â  Â  Â  Â  .btn { width: 100%; padding: 15px; background: var(--cor-primaria); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
Â  Â  Â  Â  .btn:disabled { background: #ccc; cursor: not-allowed; }
Â  Â  Â  Â  #resultado { margin-top: 20px; padding: 20px; text-align: center; font-size: 22px; border-radius: 10px; display: none; background: #e8f5e9; color: #2e7d32; }
Â  Â  Â  Â  .ranking { margin-top: 30px; border-top: 1px solid #ddd; padding-top: 20px; }
Â  Â  Â  Â  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
Â  Â  Â  Â  th, td { padding: 12px; border: 1px solid #eee; text-align: left; }
Â  Â  Â  Â  th { background-color: var(--cor-primaria); color: white; }
Â  Â  Â  Â  input[type="text"] { width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; transition: 0.3s; }
Â  Â  </style>
</head>
<body>

<div class="container">
Â  Â  <header>
Â  Â  Â  Â  <h1>Simulado LPI</h1>
Â  Â  Â  Â  <div id="timer">10:00</div>
Â  Â  </header>
Â  Â Â 
Â  Â  <div id="identificacao">
Â  Â  Â  Â  <label>Seu Nome (ObrigatÃ³rio):</label>
Â  Â  Â  Â  <input type="text" id="nomeUsuario" placeholder="Digite seu nome para validar o resultado...">
Â  Â  </div>

Â  Â  <div id="quiz-container"></div>
Â  Â Â 
Â  Â  <button class="btn" id="btnFinalizar" onclick="finalizarQuiz()">Finalizar Simulado</button>
Â  Â  <div id="resultado"></div>

Â  Â  <div class="ranking">
Â  Â  Â  Â  <h3>ğŸ† Melhores PontuaÃ§Ãµes Consolidadas</h3>
Â  Â  Â  Â  <table id="tabelaRanking">
Â  Â  Â  Â  Â  Â  <thead><tr><th>Nome</th><th>Pontos Totais</th></tr></thead>
Â  Â  Â  Â  Â  Â  <tbody><tr><td colspan="2">Carregando ranking...</td></tr></tbody>
Â  Â  Â  Â  </table>
Â  Â  </div>
</div>

<script>
Â  Â  const URL_GOOGLE_SCRIPT = "https://script.google.com/macros/s/AKfycbwL_7_XW1WhImX-9jpJ6JJ81kQMC3dgGWShTAKkVBgugtiaj2ve81NplJDuTN1k0_uNnw/exec";

Â  Â  let bancoDePerguntas = []; // ComeÃ§a vazio
    let perguntasSorteadas = [];

    async function carregarPerguntas() {
        try {
            // Buscamos as perguntas usando o parÃ¢metro ?tipo=perguntas
            const res = await fetch(URL_GOOGLE_SCRIPT + "?tipo=perguntas");
            bancoDePerguntas = await res.json();
            
            // SÃ³ inicia o quiz apÃ³s carregar as perguntas
            montarQuiz();
        } catch (e) {
            console.error("Erro ao carregar perguntas:", e);
            document.getElementById('quiz-container').innerHTML = "Erro ao carregar perguntas do servidor.";
        }
    }

    function montarQuiz() {
        perguntasSorteadas = bancoDePerguntas.sort(() => 0.5 - Math.random()).slice(0, 10);
        const container = document.getElementById('quiz-container');
        container.innerHTML = "";
        
        perguntasSorteadas.forEach((p, index) => {
            let html = `<div class="pergunta"><p>${index + 1}. ${p.q}</p>`;
            p.options.forEach((opt, i) => {
                html += `<label><input type="radio" name="p${index}" value="${i}"> ${opt}</label>`;
            });
            html += `</div>`;
            container.innerHTML += html;
        });
        iniciarTimer();
        atualizarTabelaRanking();
    }

    // No final do seu script, mude o window.onload:
    window.onload = carregarPerguntas;
Â  Â  let perguntasSorteadas = [];
Â  Â  let tempoRestante = 600;
Â  Â  let intervaloTimer;

Â  Â  function iniciarTimer() {
Â  Â  Â  Â  intervaloTimer = setInterval(() => {
Â  Â  Â  Â  Â  Â  let minutos = Math.floor(tempoRestante / 60);
Â  Â  Â  Â  Â  Â  let segundos = tempoRestante % 60;
Â  Â  Â  Â  Â  Â  segundos = segundos < 10 ? '0' + segundos : segundos;
Â  Â  Â  Â  Â  Â  document.getElementById('timer').innerHTML = `${minutos}:${segundos}`;
Â  Â  Â  Â  Â  Â  if (tempoRestante <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(intervaloTimer);
Â  Â  Â  Â  Â  Â  Â  Â  finalizarQuiz(true);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  tempoRestante--;
Â  Â  Â  Â  }, 1000);
Â  Â  }

Â  Â  function iniciarQuiz() {
Â  Â  Â  Â  perguntasSorteadas = bancoDePerguntas.sort(() => 0.5 - Math.random()).slice(0, 10);
Â  Â  Â  Â  const container = document.getElementById('quiz-container');
Â  Â  Â  Â  container.innerHTML = "";
Â  Â  Â  Â  perguntasSorteadas.forEach((p, index) => {
Â  Â  Â  Â  Â  Â  let html = `<div class="pergunta"><p>${index + 1}. ${p.q}</p>`;
Â  Â  Â  Â  Â  Â  p.options.forEach((opt, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  html += `<label><input type="radio" name="p${index}" value="${i}"> ${opt}</label>`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  html += `</div>`;
Â  Â  Â  Â  Â  Â  container.innerHTML += html;
Â  Â  Â  Â  });
Â  Â  Â  Â  iniciarTimer();
Â  Â  Â  Â  atualizarTabelaRanking();
Â  Â  }

Â  Â  async function finalizarQuiz(forcado = false) {
Â  Â  Â  Â  const inputNome = document.getElementById('nomeUsuario');
Â  Â  Â  Â  const nome = inputNome.value.trim();

Â  Â  Â  Â  // VALIDAÃ‡ÃƒO RIGOROSA DO NOME
Â  Â  Â  Â  if (!nome) {
Â  Â  Â  Â  Â  Â  alert("ERRO: VocÃª precisa digitar seu nome para salvar o simulado!");
Â  Â  Â  Â  Â  Â  inputNome.style.borderColor = "red";
Â  Â  Â  Â  Â  Â  inputNome.style.backgroundColor = "#fff0f0";
Â  Â  Â  Â  Â  Â  inputNome.focus();
Â  Â  Â  Â  Â  Â  return; // Interrompe totalmente a funÃ§Ã£o aqui
Â  Â  Â  Â  }

Â  Â  Â  Â  let pontos = 0;
Â  Â  Â  Â  let respondidas = 0;

Â  Â  Â  Â  perguntasSorteadas.forEach((p, index) => {
Â  Â  Â  Â  Â  Â  const selecionada = document.querySelector(`input[name="p${index}"]:checked`);
Â  Â  Â  Â  Â  Â  if (selecionada) {
Â  Â  Â  Â  Â  Â  Â  Â  respondidas++;
Â  Â  Â  Â  Â  Â  Â  Â  if (parseInt(selecionada.value) === p.correct) pontos += 10;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  if (!forcado && respondidas < 10) {
Â  Â  Â  Â  Â  Â  alert("Por favor, responda todas as questÃµes!");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Se chegou aqui, o nome existe e as questÃµes foram respondidas.
Â  Â  Â  Â  clearInterval(intervaloTimer);
Â  Â  Â  Â  const btn = document.getElementById('btnFinalizar');
Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  btn.innerText = "Enviando dados...";

Â  Â  Â  Â  await salvarNoRanking(nome, pontos);
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('resultado').style.display = "block";
Â  Â  Â  Â  document.getElementById('resultado').innerHTML = `<h3>Simulado ConcluÃ­do!</h3><p>ParabÃ©ns <b>${nome}</b>, sua nota foi: <b>${pontos} pontos</b></p>`;
Â  Â  Â  Â  btn.style.display = "none";
Â  Â  Â  Â  document.getElementById('identificacao').style.display = "none";
Â  Â  }

Â  Â  async function salvarNoRanking(nome, pontos) {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // Envia para o Google Sheets
Â  Â  Â  Â  Â  Â  await fetch(URL_GOOGLE_SCRIPT, {
Â  Â  Â  Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  Â  Â  Â  mode: "no-cors",
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ nome: nome, pontos: pontos })
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Aguarda um pouco para o Google processar e atualiza a tabela
Â  Â  Â  Â  Â  Â  setTimeout(atualizarTabelaRanking, 2000);
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Erro ao salvar:", e);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  async function atualizarTabelaRanking() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(URL_GOOGLE_SCRIPT);
Â  Â  Â  Â  Â  Â  const dadosBrutos = await res.json();
Â  Â  Â  Â  Â  Â  const tbody = document.querySelector('#tabelaRanking tbody');
Â  Â  Â  Â  Â  Â  tbody.innerHTML = "";Â 

Â  Â  Â  Â  Â  Â  if (!dadosBrutos || dadosBrutos.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  tbody.innerHTML = "<tr><td colspan='2'>Nenhuma pontuaÃ§Ã£o registrada.</td></tr>";
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const rankingAgrupado = {};
Â  Â  Â  Â  Â  Â  dadosBrutos.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  if (item && item.length >= 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let nomeOriginal = item[0].toString().trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let pontos = parseInt(item[1]) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let chave = nomeOriginal.toLowerCase();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (rankingAgrupado[chave]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rankingAgrupado[chave].pontos += pontos;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rankingAgrupado[chave] = { nome: nomeOriginal, pontos: pontos };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const rankingFinal = Object.values(rankingAgrupado);
Â  Â  Â  Â  Â  Â  rankingFinal.sort((a, b) => b.pontos - a.pontos);

Â  Â  Â  Â  Â  Â  rankingFinal.slice(0, 10).forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  tbody.innerHTML += `<tr><td>${item.nome}</td><td>${item.pontos} pts</td></tr>`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } catch (e) {Â 
Â  Â  Â  Â  Â  Â  console.log("Erro ao carregar ranking:", e);Â 
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Resetar cor do campo quando o usuÃ¡rio digitar
Â  Â  document.getElementById('nomeUsuario').addEventListener('input', function() {
Â  Â  Â  Â  this.style.borderColor = "#ddd";
Â  Â  Â  Â  this.style.backgroundColor = "#fff";
Â  Â  });

Â  Â  window.onload = iniciarQuiz;
</script>
</body>
</html>
